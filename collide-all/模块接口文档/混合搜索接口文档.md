# 混合搜索接口文档

## 文档信息
- **文档名称**: 混合搜索接口文档
- **版本**: 2.0.0
- **更新时间**: 2024-01-31
- **描述**: 提供多种混合搜索功能，支持内容、用户、标签等多种搜索场景

---

## 目录
1. [基础搜索功能](#1-基础搜索功能)
2. [Tag混合搜索功能](#2-tag混合搜索功能)
3. [视频混合搜索功能](#3-视频混合搜索功能)
4. [搜索历史管理](#4-搜索历史管理)
5. [热门搜索功能](#5-热门搜索功能)
6. [搜索建议功能](#6-搜索建议功能)
7. [通用响应格式](#7-通用响应格式)
8. [错误码说明](#8-错误码说明)
9. [使用场景说明](#9-使用场景说明)

---

## 1. 基础搜索功能

### 1.1 执行搜索
- **接口路径**: `POST /api/v1/search`
- **请求方式**: POST
- **功能描述**: 根据关键词和搜索类型执行搜索，支持分页和排序

#### 请求参数
```json
{
  "keyword": "搜索关键词",
  "searchType": "content",
  "userId": 123,
  "currentPage": 1,
  "pageSize": 20,
  "sortBy": "relevance",
  "recordHistory": true
}
```

#### 参数说明
| 参数名 | 类型 | 必填 | 默认值 | 描述 |
|--------|------|------|--------|------|
| keyword | String | 是 | - | 搜索关键词（最大200字符） |
| searchType | String | 否 | content | 搜索类型：content(内容)、goods(商品)、user(用户) |
| userId | Long | 是 | - | 用户ID（用于记录搜索历史） |
| currentPage | Integer | 否 | 1 | 当前页码 |
| pageSize | Integer | 否 | 20 | 页面大小 |
| sortBy | String | 否 | relevance | 排序方式：relevance(相关度)、time(时间)、hot(热度) |
| recordHistory | Boolean | 否 | true | 是否记录搜索历史 |

#### 响应示例
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "keyword": "搜索关键词",
    "searchType": "content",
    "totalCount": 100,
    "results": [
      {
        "id": 1,
        "title": "内容标题",
        "content": "内容摘要",
        "type": "content",
        "thumbnail": "https://example.com/thumb.jpg",
        "score": 0.95,
        "highlight": "搜索关键词高亮显示"
      }
    ],
    "suggestions": ["建议1", "建议2"],
    "hasMore": true,
    "duration": 150
  }
}
```

---

## 2. Tag混合搜索功能

### 2.1 Tag混合搜索
- **接口路径**: `GET /api/v1/search/tag/{tag}/mixed`
- **请求方式**: GET
- **功能描述**: 根据标签同时搜索用户和内容，返回聚合结果

#### 请求参数
| 参数名 | 类型 | 必填 | 默认值 | 描述 |
|--------|------|------|--------|------|
| tag | String | 是 | - | 标签名称（路径参数） |
| currentPage | Integer | 否 | 1 | 当前页码 |
| pageSize | Integer | 否 | 20 | 页面大小 |

#### 请求示例
```http
GET /api/v1/search/tag/娱乐/mixed?currentPage=1&pageSize=20
```

#### 响应示例
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "records": [
      {
        "id": 1,
        "type": "content",
        "title": "娱乐视频",
        "author": "作者名称",
        "tags": ["娱乐", "搞笑"]
      },
      {
        "id": 123,
        "type": "user",
        "nickname": "娱乐达人",
        "avatar": "https://example.com/avatar.jpg",
        "tags": ["娱乐", "视频"]
      }
    ],
    "total": 50,
    "currentPage": 1,
    "pageSize": 20,
    "totalPages": 3
  }
}
```

### 2.2 根据Tag搜索用户
- **接口路径**: `GET /api/v1/search/tag/{tag}/users`
- **请求方式**: GET
- **功能描述**: 根据标签搜索相关用户

#### 请求示例
```http
GET /api/v1/search/tag/娱乐/users?currentPage=1&pageSize=20
```

### 2.3 根据Tag搜索内容
- **接口路径**: `GET /api/v1/search/tag/{tag}/contents`
- **请求方式**: GET
- **功能描述**: 根据标签搜索相关内容

#### 请求示例
```http
GET /api/v1/search/tag/娱乐/contents?currentPage=1&pageSize=20
```

---

## 3. 视频混合搜索功能

### 3.1 视频混合搜索
- **接口路径**: `POST /api/v1/search/videos`
- **请求方式**: POST
- **功能描述**: 支持多种搜索条件组合的视频混合搜索

#### 请求参数
```json
{
  "keyword": "搜索关键词",
  "contentType": "VIDEO",
  "categoryId": 1,
  "authorId": 123,
  "tags": ["娱乐", "搞笑"],
  "priceCondition": {
    "priceType": "ALL",
    "minPrice": 0,
    "maxPrice": 100,
    "vipOnly": false,
    "trialEnabled": true
  },
  "timeCondition": {
    "timeRange": "THIS_MONTH",
    "customDays": 30
  },
  "sortBy": "hot",
  "sortDirection": "DESC",
  "currentPage": 1,
  "pageSize": 20,
  "includeOffline": false
}
```

#### 参数说明
| 参数名 | 类型 | 必填 | 默认值 | 描述 |
|--------|------|------|--------|------|
| keyword | String | 否 | - | 搜索关键词（最大200字符） |
| contentType | String | 否 | - | 内容类型：VIDEO、NOVEL、COMIC、ARTICLE、AUDIO、ALL |
| categoryId | Long | 否 | - | 分类ID |
| authorId | Long | 否 | - | 作者ID |
| tags | List<String> | 否 | - | 标签列表 |
| priceCondition | Object | 否 | - | 价格搜索条件 |
| timeCondition | Object | 否 | - | 时间搜索条件 |
| sortBy | String | 否 | hot | 排序方式：hot、favorite、latest、relevance、random |
| sortDirection | String | 否 | DESC | 排序方向：ASC、DESC |
| currentPage | Integer | 否 | 1 | 当前页码 |
| pageSize | Integer | 否 | 20 | 页面大小 |
| includeOffline | Boolean | 否 | false | 是否包含下线内容 |

#### 价格搜索条件说明
```json
{
  "priceType": "ALL",        // 价格类型：ALL(全类型)、FREE(免费)、VIP(VIP免费)、PAID(付费解锁)
  "minPrice": 0,             // 最小价格
  "maxPrice": 100,           // 最大价格
  "vipOnly": false,          // 是否只显示VIP专享内容
  "trialEnabled": true       // 是否只显示支持试读的内容
}
```

#### 时间搜索条件说明
```json
{
  "timeRange": "THIS_MONTH", // 时间范围：THIS_WEEK(本周)、THIS_MONTH(本月)、HALF_YEAR(半年)、CUSTOM(自定义)
  "customDays": 30           // 自定义天数（当timeRange为CUSTOM时使用）
}
```

#### 响应示例
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "records": [
      {
        "contentId": 1,
        "title": "热门视频标题",
        "description": "视频描述",
        "contentType": "VIDEO",
        "status": "PUBLISHED",
        "author": {
          "authorId": 123,
          "authorNickname": "热门作者",
          "authorAvatar": "https://example.com/avatar.jpg"
        },
        "category": {
          "categoryId": 1,
          "categoryName": "娱乐"
        },
        "tags": ["娱乐", "搞笑"],
        "payment": {
          "paymentType": "FREE",
          "price": 0,
          "vipFree": true,
          "trialEnabled": true
        },
        "statistics": {
          "viewCount": 10000,
          "likeCount": 500,
          "favoriteCount": 300,
          "score": 4.8
        },
        "timeInfo": {
          "createTime": "2024-01-25T10:30:00",
          "publishTime": "2024-01-25T10:30:00"
        },
        "relevanceScore": 0.95
      }
    ],
    "total": 100,
    "currentPage": 1,
    "pageSize": 20,
    "totalPages": 5
  }
}
```

### 3.2 获取视频搜索建议
- **接口路径**: `GET /api/v1/search/videos/suggestions`
- **请求方式**: GET
- **功能描述**: 获取视频搜索建议

#### 请求参数
| 参数名 | 类型 | 必填 | 默认值 | 描述 |
|--------|------|------|--------|------|
| keyword | String | 是 | - | 搜索关键词 |
| limit | Integer | 否 | 10 | 建议数量限制 |

#### 请求示例
```http
GET /api/v1/search/videos/suggestions?keyword=娱乐&limit=10
```

#### 响应示例
```json
{
  "code": 200,
  "message": "success",
  "data": ["娱乐视频", "娱乐搞笑", "娱乐新闻", "娱乐八卦"]
}
```

### 3.3 获取热门视频标签
- **接口路径**: `GET /api/v1/search/videos/hot-tags`
- **请求方式**: GET
- **功能描述**: 获取热门视频标签

#### 请求参数
| 参数名 | 类型 | 必填 | 默认值 | 描述 |
|--------|------|------|--------|------|
| limit | Integer | 否 | 20 | 标签数量限制 |

#### 请求示例
```http
GET /api/v1/search/videos/hot-tags?limit=20
```

#### 响应示例
```json
{
  "code": 200,
  "message": "success",
  "data": ["娱乐", "搞笑", "音乐", "舞蹈", "美食", "旅游", "科技", "教育"]
}
```

---

## 4. 搜索历史管理

### 4.1 获取搜索历史
- **接口路径**: `GET /api/v1/search/history`
- **请求方式**: GET
- **功能描述**: 分页获取用户的搜索历史记录

#### 请求参数
| 参数名 | 类型 | 必填 | 默认值 | 描述 |
|--------|------|------|--------|------|
| userId | Long | 是 | - | 用户ID |
| currentPage | Integer | 否 | 1 | 当前页码 |
| pageSize | Integer | 否 | 20 | 页面大小 |
| searchType | String | 否 | - | 搜索类型筛选 |

#### 请求示例
```http
GET /api/v1/search/history?userId=123&currentPage=1&pageSize=20
```

#### 响应示例
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "records": [
      {
        "id": 1,
        "userId": 123,
        "keyword": "娱乐视频",
        "searchType": "content",
        "resultCount": 50,
        "searchTime": "2024-01-25T10:30:00"
      }
    ],
    "total": 25,
    "currentPage": 1,
    "pageSize": 20,
    "totalPages": 2
  }
}
```

### 4.2 清空搜索历史
- **接口路径**: `DELETE /api/v1/search/history/user/{userId}`
- **请求方式**: DELETE
- **功能描述**: 清空指定用户的所有搜索历史记录

#### 请求示例
```http
DELETE /api/v1/search/history/user/123
```

### 4.3 删除指定搜索历史
- **接口路径**: `DELETE /api/v1/search/history/{historyId}`
- **请求方式**: DELETE
- **功能描述**: 删除指定的搜索历史记录

#### 请求示例
```http
DELETE /api/v1/search/history/1
```

---

## 5. 热门搜索功能

### 5.1 获取热门搜索关键词
- **接口路径**: `GET /api/v1/search/hot-keywords`
- **请求方式**: GET
- **功能描述**: 获取热门搜索关键词列表

#### 请求参数
| 参数名 | 类型 | 必填 | 默认值 | 描述 |
|--------|------|------|--------|------|
| limit | Integer | 否 | 20 | 关键词数量限制 |

#### 请求示例
```http
GET /api/v1/search/hot-keywords?limit=20
```

#### 响应示例
```json
{
  "code": 200,
  "message": "success",
  "data": [
    {
      "id": 1,
      "keyword": "娱乐视频",
      "searchCount": 1500,
      "trendScore": 0.95,
      "createTime": "2024-01-25T10:30:00"
    }
  ]
}
```

### 5.2 根据搜索类型获取热门关键词
- **接口路径**: `GET /api/v1/search/hot-keywords/{searchType}`
- **请求方式**: GET
- **功能描述**: 根据搜索类型获取热门关键词

#### 请求参数
| 参数名 | 类型 | 必填 | 默认值 | 描述 |
|--------|------|------|--------|------|
| searchType | String | 是 | - | 搜索类型：content、goods、user |
| limit | Integer | 否 | 20 | 关键词数量限制 |

#### 请求示例
```http
GET /api/v1/search/hot-keywords/content?limit=20
```

---

## 6. 搜索建议功能

### 6.1 获取搜索建议
- **接口路径**: `GET /api/v1/search/suggestions`
- **请求方式**: GET
- **功能描述**: 获取搜索建议/自动补全

#### 请求参数
| 参数名 | 类型 | 必填 | 默认值 | 描述 |
|--------|------|------|--------|------|
| keyword | String | 是 | - | 搜索关键词 |
| limit | Integer | 否 | 10 | 建议数量限制 |

#### 请求示例
```http
GET /api/v1/search/suggestions?keyword=娱乐&limit=10
```

#### 响应示例
```json
{
  "code": 200,
  "message": "success",
  "data": ["娱乐视频", "娱乐新闻", "娱乐八卦", "娱乐明星"]
}
```

### 6.2 获取用户搜索偏好
- **接口路径**: `GET /api/v1/search/preferences/{userId}`
- **请求方式**: GET
- **功能描述**: 获取用户搜索偏好分析

#### 请求示例
```http
GET /api/v1/search/preferences/123
```

#### 响应示例
```json
{
  "code": 200,
  "message": "success",
  "data": [
    {
      "keyword": "娱乐",
      "searchCount": 50,
      "lastSearchTime": "2024-01-25T10:30:00",
      "preferenceScore": 0.8
    }
  ]
}
```

---

## 7. 通用响应格式

### 成功响应
```json
{
  "code": 200,
  "message": "success",
  "data": {
    // 具体数据
  }
}
```

### 分页响应
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "records": [
      // 数据列表
    ],
    "total": 100,
    "currentPage": 1,
    "pageSize": 20,
    "totalPages": 5
  }
}
```

### 错误响应
```json
{
  "code": 400,
  "message": "错误信息",
  "data": null
}
```

---

## 8. 错误码说明

| 错误码 | 说明 |
|--------|------|
| 200 | 成功 |
| 400 | 请求参数错误 |
| 401 | 未授权 |
| 403 | 禁止访问 |
| 404 | 资源不存在 |
| 500 | 服务器内部错误 |

---

## 9. 使用场景说明

### 9.1 基础搜索场景
- **场景**: 用户输入关键词搜索内容
- **使用接口**: `POST /api/v1/search`
- **参数配置**: 
  - searchType: "content" (搜索内容)
  - sortBy: "relevance" (按相关度排序)
  - recordHistory: true (记录搜索历史)

### 9.2 Tag混合搜索场景
- **场景**: 用户点击标签，同时查看相关内容和用户
- **使用接口**: `GET /api/v1/search/tag/{tag}/mixed`
- **特点**: 返回混合结果，包含内容和用户信息

### 9.3 视频高级搜索场景
- **场景**: 用户需要精确筛选视频内容
- **使用接口**: `POST /api/v1/search/videos`
- **支持条件**:
  - 关键词搜索
  - 内容类型筛选
  - 分类筛选
  - 作者筛选
  - 标签筛选
  - 价格筛选
  - 时间筛选
  - 多种排序方式

### 9.4 搜索建议场景
- **场景**: 用户输入时提供搜索建议
- **使用接口**: `GET /api/v1/search/suggestions`
- **特点**: 实时返回搜索建议

### 9.5 热门搜索场景
- **场景**: 展示热门搜索关键词
- **使用接口**: `GET /api/v1/search/hot-keywords`
- **特点**: 基于搜索统计的热门关键词

### 9.6 搜索历史场景
- **场景**: 用户查看和管理搜索历史
- **使用接口**: `GET /api/v1/search/history`
- **功能**: 查看、清空、删除搜索历史

### 9.7 个性化推荐场景
- **场景**: 基于用户搜索偏好推荐内容
- **使用接口**: `GET /api/v1/search/preferences/{userId}`
- **特点**: 分析用户搜索行为，提供个性化推荐

---

## 注意事项

1. **搜索关键词长度限制**: 最大200字符
2. **分页参数**: 页码从1开始，页面大小建议不超过100
3. **搜索历史**: 需要用户登录才能记录搜索历史
4. **热门搜索**: 基于实际搜索统计，定期更新
5. **搜索建议**: 基于用户搜索历史和热门关键词生成
6. **视频搜索**: 支持复杂的多条件组合搜索
7. **Tag搜索**: 支持标签的模糊匹配和精确匹配
8. **性能优化**: 所有搜索接口都支持分页，避免大量数据返回
9. **缓存策略**: 热门搜索和搜索建议支持缓存，提升响应速度
10. **权限控制**: 搜索历史相关接口需要用户身份验证
