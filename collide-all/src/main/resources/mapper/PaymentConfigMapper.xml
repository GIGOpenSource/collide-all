<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.gig.collide.mapper.PaymentConfigMapper">

    <!-- 基础字段映射 -->
    <sql id="Base_Column_List">
        id, platform_name, base_url, merchant_id, app_secret, sub_merchant_id, 
        payment_method, notify_url, sign_type, deleted, create_time, update_time
    </sql>

    <!-- 基础查询条件：过滤已删除记录 -->
    <sql id="Base_Where">
        WHERE deleted = 0
    </sql>

    <!-- =================== 基础查询 =================== -->

    <!-- 根据平台名称查询配置 -->
    <select id="selectByPlatformName" resultType="com.gig.collide.domain.PaymentConfig">
        SELECT <include refid="Base_Column_List"/>
        FROM t_payment_config
        <include refid="Base_Where"/>
        AND platform_name = #{platformName}
    </select>

    <!-- 根据商户ID查询配置 -->
    <select id="selectByMerchantId" resultType="com.gig.collide.domain.PaymentConfig">
        SELECT <include refid="Base_Column_List"/>
        FROM t_payment_config
        <include refid="Base_Where"/>
        AND merchant_id = #{merchantId}
        ORDER BY create_time DESC
    </select>

    <!-- 查询所有启用的配置 -->
    <select id="selectActiveConfigs" resultType="com.gig.collide.domain.PaymentConfig">
        SELECT <include refid="Base_Column_List"/>
        FROM t_payment_config
        <include refid="Base_Where"/>
        ORDER BY platform_name ASC
    </select>

    <!-- 根据支付方式查询配置 -->
    <select id="selectByPaymentMethod" resultType="com.gig.collide.domain.PaymentConfig">
        SELECT <include refid="Base_Column_List"/>
        FROM t_payment_config
        <include refid="Base_Where"/>
        AND payment_method = #{paymentMethod}
        ORDER BY platform_name ASC
    </select>

    <!-- 根据签名类型查询配置 -->
    <select id="selectBySignType" resultType="com.gig.collide.domain.PaymentConfig">
        SELECT <include refid="Base_Column_List"/>
        FROM t_payment_config
        <include refid="Base_Where"/>
        AND sign_type = #{signType}
        ORDER BY platform_name ASC
    </select>

</mapper>